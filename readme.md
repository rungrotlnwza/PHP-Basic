<?php
// ===========================
// บทเรียน PHP ฉบับสมบูรณ์พร้อมคำอธิบาย
// ===========================

/*
PHP (Hypertext Preprocessor) เป็นภาษาสคริปต์ที่ทำงานฝั่งเซิร์ฟเวอร์ ถูกออกแบบมาเพื่อสร้างหน้าเว็บแบบไดนามิก
ซึ่งสามารถแทรกเข้าไปใน HTML และรันบนเซิร์ฟเวอร์ก่อนจะส่งผลลัพธ์กลับมาเป็น HTML ให้กับเบราว์เซอร์
*/

// 1. การเริ่มต้นเขียน PHP
/* แท็ก <?php ... ?> ใช้สำหรับการเขียนโค้ด PHP ในไฟล์ HTML
 โค้ดที่อยู่ในแท็กนี้จะถูกรันบนเซิร์ฟเวอร์ และผลลัพธ์จะถูกส่งกลับมาเป็น HTML ให้ผู้ใช้เห็น
*/
?>
<!DOCTYPE html>
<html>
<head>
    <title>PHP Basic with Explanation</title>
</head>
<body>
    <h1>ตัวอย่าง PHP เบื้องต้น</h1>
    <?php
    // 2. การแสดงผลด้วย echo และ print
    // echo และ print ใช้ในการแสดงผลข้อความหรือค่าตัวแปรไปยังหน้า HTML ที่จะถูกแสดงในเบราว์เซอร์
    // echo สามารถแสดงผลข้อความหลาย ๆ ข้อความได้ในครั้งเดียว ส่วน print จะใช้แสดงข้อความได้ทีละบรรทัดเท่านั้น
    echo "แสดงผลด้วย echo<br>";
    print "แสดงผลด้วย print<br>";

    // 3. ตัวแปรใน PHP
    // PHP ใช้ตัวแปรในการเก็บข้อมูล โดยตัวแปรต้องขึ้นต้นด้วยเครื่องหมาย $
    // PHP จะกำหนดชนิดของข้อมูลอัตโนมัติตามค่าที่ถูกกำหนดให้
    // ชนิดข้อมูลใน PHP เช่น string (ข้อความ), integer (ตัวเลข), boolean (true/false)

    $name = "Rungrot";  // ตัวแปรชนิด string
    $age = 20;          // ตัวแปรชนิด integer
    $is_active = true;   // ตัวแปรชนิด boolean

    // echo ใช้เพื่อแสดงผลค่าของตัวแปร
    echo "ชื่อ: $name, อายุ: $age ปี<br>";

    // 4. ตัวดำเนินการทางคณิตศาสตร์ (Arithmetic Operators)
    // PHP รองรับการดำเนินการทางคณิตศาสตร์ เช่น การบวก ลบ คูณ หาร
    // การบวกใช้เครื่องหมาย +, ลบใช้ -, คูณใช้ *, หารใช้ /

    $x = 10; // กำหนดค่าให้ตัวแปร $x
    $y = 5;  // กำหนดค่าให้ตัวแปร $y

    // การดำเนินการทางคณิตศาสตร์และเก็บผลลัพธ์ในตัวแปรใหม่
    $sum = $x + $y;        // ผลบวก
    $difference = $x - $y; // ผลลบ
    $product = $x * $y;    // ผลคูณ
    $quotient = $x / $y;   // ผลหาร

    // แสดงผลลัพธ์ของการคำนวณ
    echo "ผลบวก: $sum, ผลลบ: $difference, ผลคูณ: $product, ผลหาร: $quotient<br>";

    // 5. การควบคุมการทำงาน (Control Structures)
    
    // 5.1 เงื่อนไข (If-Else)
    // if-else ใช้ตรวจสอบเงื่อนไข ถ้าเงื่อนไขเป็นจริง จะรันคำสั่งในบล็อก if
    // ถ้าไม่เป็นจริง จะรันคำสั่งในบล็อก else แทน
    $age = 20; // กำหนดอายุ

    if ($age >= 18) {
        // ถ้าอายุ 18 ปีขึ้นไป จะถือว่าเป็นผู้ใหญ่
        echo "คุณเป็นผู้ใหญ่แล้ว<br>";
    } else {
        // ถ้าอายุน้อยกว่า 18 ปี จะถือว่าเป็นเด็ก
        echo "คุณยังเป็นเด็ก<br>";
    }

    // 5.2 ลูป (Loop)
    // ลูปใช้ในการทำงานซ้ำ เช่น การวนลูปเพื่อแสดงข้อความหลายครั้ง
    // ตัวอย่างที่ใช้ได้ใน PHP มี for, while, foreach

    // ลูป for จะวนทำงานตามจำนวนครั้งที่กำหนด
    echo "ลูป for:<br>";
    for ($i = 1; $i <= 5; $i++) {
        // แสดงข้อความ 5 รอบ
        echo "รอบที่ $i<br>";
    }

    // ลูป while จะวนทำงานตามเงื่อนไขที่กำหนด
    echo "ลูป while:<br>";
    $count = 1; // กำหนดค่าเริ่มต้น

    while ($count <= 5) {
        // แสดงข้อความจนกว่า $count จะมีค่าน้อยกว่าหรือเท่ากับ 5
        echo "รอบที่ $count<br>";
        $count++; // เพิ่มค่าตัวแปร $count
    }

    // 6. ฟังก์ชัน (Functions)
    // ฟังก์ชันคือชุดคำสั่งที่ถูกกำหนดขึ้นมาเพื่อให้สามารถเรียกใช้ซ้ำได้
    // ฟังก์ชันช่วยลดความซ้ำซ้อนของโค้ด และทำให้โค้ดดูเป็นระเบียบ
    // การสร้างฟังก์ชันใช้คำสั่ง function ตามด้วยชื่อฟังก์ชัน

    function sayHello($name) {
        // ฟังก์ชันนี้รับพารามิเตอร์ $name และจะคืนข้อความที่ใช้พารามิเตอร์นี้
        return "สวัสดี, $name!";
    }

    // เรียกใช้ฟังก์ชัน sayHello และส่งค่า "PHP" เป็นพารามิเตอร์
    echo sayHello("PHP")."<br>";

    // 7. การรับข้อมูลจากฟอร์ม (Form Handling)
    // PHP สามารถรับข้อมูลจากฟอร์ม HTML ผ่าน method POST หรือ GET
    // $_POST หรือ $_GET เป็นตัวแปรที่ใช้เก็บข้อมูลจากฟอร์มที่ส่งมาจากผู้ใช้

    ?>
    <form method="post" action="">
        ชื่อ: <input type="text" name="user_name"><br>
        <input type="submit" value="ส่งข้อมูล">
    </form>
    <?php
    // ตรวจสอบว่ามีการส่งข้อมูลผ่านฟอร์มด้วย method POST หรือไม่
    if ($_SERVER["REQUEST_METHOD"] == "POST") {
        // รับค่าที่ถูกส่งมาจากฟอร์มและเก็บไว้ในตัวแปร $user_name
        $user_name = $_POST['user_name'];
        // แสดงค่าที่รับมาจากฟอร์ม
        echo "ยินดีต้อนรับ, $user_name<br>";
    }

    // 8. การเชื่อมต่อฐานข้อมูล MySQL (Database Connection)
    // PHP รองรับการเชื่อมต่อฐานข้อมูล เช่น MySQL โดยใช้ฟังก์ชัน mysqli_connect
    // เราต้องกำหนดข้อมูลเซิร์ฟเวอร์, ชื่อผู้ใช้, รหัสผ่าน และชื่อฐานข้อมูล

    $servername = "localhost";
    $username = "root";
    $password = "";
    $dbname = "test_db";

    // สร้างการเชื่อมต่อฐานข้อมูล
    $conn = mysqli_connect($servername, $username, $password, $dbname);

    // ตรวจสอบว่าการเชื่อมต่อสำเร็จหรือไม่
    if (!$conn) {
        die("การเชื่อมต่อล้มเหลว: " . mysqli_connect_error()); // ถ้าเชื่อมต่อไม่ได้ ให้แสดงข้อความแสดงข้อผิดพลาด
    }

    // ดึงข้อมูลจากตาราง users ในฐานข้อมูล
    $sql = "SELECT id, name FROM users";
    $result = mysqli_query($conn, $sql); // รันคำสั่ง SQL

    // ตรวจสอบว่ามีข้อมูลหรือไม่
    if (mysqli_num_rows($result) > 0) {
        // วนลูปเพื่อแสดงข้อมูลแต่ละแถว
        while ($row = mysqli_fetch_assoc($result)) {
            echo "ID: " . $row["id"] . " - ชื่อ: " . $row["name"] . "<br>";
        }
    } else {
        // ถ้าไม่มีข้อมูลให้แสดงข้อความ
        echo "ไม่มีข้อมูล<br>";
    }

    // ปิดการเชื่อมต่อฐานข้อมูล
    mysqli_close($conn);

    // 9. การจัดการ Session
    // Session ใช้สำหรับเก็บข้อมูลชั่วคราวของผู้ใช้ขณะใช้งานเว็บไซต์
    // ข้อมูลที่เก็บใน Session จะสามารถเข้าถึงได้ตลอดการเข้าชมเว็บไซต์ของผู้ใช้

    session_start(); // เริ่มต้น session ใหม่
    $_SESSION["username"] = "ChatGPT"; // เก็บข้อมูลใน session
    echo "Session ชื่อผู้ใช้: " . $_SESSION["username"] . "<br>";

    // 10. การจัดการ Cookies
    // Cookies ใช้เก็บข้อมูลของผู้ใช้ในเครื่องของผู้ใช้เอง และสามารถเก็บข้อมูลได้นานกว่า session
    // เราสามารถตั้งค่า cookies โดยใช้ฟังก์ชัน setcookie()

    setcookie("user", "ChatGPT", time() + (86400 * 30), "/"); // สร้าง cookies ที่ชื่อว่า "user" เก็บค่า "ChatGPT"

    // ตรวจสอบว่ามี cookies ที่ชื่อว่า "user" หรือไม่
    if (isset($_COOKIE["user"])) {
        echo "ยินดีต้อนรับ, " . $_COOKIE["user"] . "<br>";
    }

    // 11. การจัดการไฟล์ (File Handling)
    // PHP สามารถอ่าน เขียน และลบไฟล์ได้
    // fopen() ใช้เปิดไฟล์, fwrite() ใช้เขียนข้อมูลลงไฟล์, fclose() ใช้ปิดไฟล์

    // การเขียนข้อมูลลงไฟล์
    $file = fopen("example.txt", "w"); // เปิดไฟล์ example.txt ในโหมดเขียน (w = write)
    fwrite($file, "สวัสดีจาก PHP");   // เขียนข้อความลงในไฟล์
    fclose($file);                     // ปิดไฟล์

    // การอ่านข้อมูลจากไฟล์
    $file = fopen("example.txt", "r");  // เปิดไฟล์ในโหมดอ่าน (r = read)
    echo fread($file, filesize("example.txt")); // อ่านและแสดงผลข้อมูลจากไฟล์
    fclose($file);                       // ปิดไฟล์
    ?>
</body>
</html>
